
OAuth2 authentication is implemented in packages/core/src/code_assist/oauth2.ts using Google's OAuth2Client from google-auth-library. You must use getOauthClient() function to obtain authenticated clients. The system supports multiple auth types: LOGIN_WITH_GOOGLE (web-based OAuth), COMPUTE_ADC (metadata server for GCE/Cloud Shell), and BYOID (external account). Credentials are cached in Storage.getOAuthCredsPath() or OAuthCredentialStorage for encrypted storage. The authEvents EventEmitter fires post_auth callbacks after successful authentication. Token refresh is handled automatically via client.on('tokens') listener. For non-interactive environments (NO_BROWSER=true), use authWithUserCode() which prompts for manual code entry.
