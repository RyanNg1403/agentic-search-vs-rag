
Chat compression service in packages/core/src/services/chatCompressionService.ts manages context window limits via LLM-based summarization. You must trigger compression when chat history exceeds DEFAULT_COMPRESSION_TOKEN_THRESHOLD (0.5 of token limit). The service uses findCompressSplitPoint() with COMPRESSION_PRESERVE_THRESHOLD (0.3) to keep recent 30% of history uncompressed. Compression uses fast models (Gemini Flash variants) via modelStringToModelConfigAlias(). Triggers firePreCompressHook() before compression. Logs ChatCompressionEvent telemetry. Split points must be at user messages without pending function responses. CompressionStatus enum tracks state.
